<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Validify</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff88;
            --primary-dim: rgba(0, 255, 136, 0.15);
            --secondary: #00d4ff;
            --accent: #667eea;
            --dark: #0a0a0f;
            --dark-card: rgba(10, 10, 15, 0.85);
            --dark-lighter: #12121a;
            --text: #ffffff;
            --text-muted: #a0a0b0;
            --danger: #ff4757;
            --success: #00ff88;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 100%);
            color: var(--text);
            min-height: 100vh;
        }

        .bg-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .dashboard-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            padding: 0.75rem 2rem;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 136, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-left { display: flex; align-items: center; gap: 2rem; }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            text-decoration: none;
            color: var(--text);
        }

        .logo-icon {
            width: 40px; height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 100%;
            height: 100%;
        }

        .logo-text {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .nav-links { display: flex; gap: 0.25rem; }

        .nav-links a {
            color: var(--text-muted);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--text);
            background: var(--primary-dim);
        }

        .nav-right { display: flex; align-items: center; gap: 1rem; }

        .back-link {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .back-link:hover {
            color: var(--text);
            background: var(--primary-dim);
        }

        .wallet-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border: none;
            padding: 0.6rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .wallet-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .wallet-btn.connected {
            background: var(--primary-dim);
            color: var(--primary);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .dashboard {
            padding: 5rem 2rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .wallet-banner {
            background: var(--dark-card);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: none;
        }

        .wallet-banner.show { display: block; }

        .wallet-banner-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .wallet-address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            color: var(--primary);
        }

        .wallet-stats { display: flex; gap: 2rem; }

        .wallet-stat { text-align: center; }

        .wallet-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wallet-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .card {
            background: var(--dark-card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .card-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            background: var(--primary-dim);
            color: var(--primary);
        }

        .tier-grid { display: flex; flex-direction: column; gap: 1rem; }

        .tier-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
        }

        .tier-card:hover {
            border-color: rgba(0, 255, 136, 0.3);
            background: var(--primary-dim);
        }

        .tier-card.active {
            border-color: var(--primary);
            background: var(--primary-dim);
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .tier-name { font-weight: 600; font-size: 1.1rem; }

        .tier-price {
            font-family: 'JetBrains Mono', monospace;
            color: var(--secondary);
        }

        .tier-features {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .tier-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .tier-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .tier-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        .tier-btn.active-btn {
            background: var(--primary-dim);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .status-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .status-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .status-value.active { color: var(--success); }
        .status-value.inactive { color: var(--text-muted); }

        .faucet-info {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .faucet-status {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .faucet-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        .event-feed { max-height: 300px; overflow-y: auto; }

        .event-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .event-category {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            background: var(--primary-dim);
            color: var(--primary);
            text-transform: uppercase;
        }

        .event-confidence { font-size: 0.75rem; color: var(--text-muted); }
        .event-title { font-size: 0.9rem; margin-bottom: 0.5rem; }

        .event-link {
            font-size: 0.8rem;
            color: var(--secondary);
            text-decoration: none;
        }

        .event-link:hover { text-decoration: underline; }

        .contract-item {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .contract-label {
            font-size: 0.75rem;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .contract-address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
            word-break: break-all;
        }

        .contract-link {
            display: inline-block;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--secondary);
            text-decoration: none;
        }

        .contract-link:hover { text-decoration: underline; }

        .connect-prompt {
            text-align: center;
            padding: 4rem 2rem;
        }

        .connect-prompt h2 { font-size: 1.75rem; margin-bottom: 1rem; }

        .connect-prompt p {
            color: var(--text-muted);
            margin-bottom: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .preview-banner {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
            border-bottom: 1px solid rgba(102, 126, 234, 0.3);
            padding: 0.75rem 2rem;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1001;
        }

        .preview-banner-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .preview-badge {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-text {
            color: var(--text);
            font-size: 0.9rem;
        }

        .preview-text a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .preview-text a:hover {
            text-decoration: underline;
        }

        .dashboard-nav {
            top: 52px;
        }

        .dashboard {
            padding-top: 140px;
        }

        .tier-btn.preview {
            background: rgba(255, 255, 255, 0.1);
            cursor: default;
            opacity: 0.7;
        }

        .tier-btn.preview:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .toast {
            position: fixed;
            top: 80px; right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            display: none;
            z-index: 2000;
        }

        .toast.show { display: block; }
        .toast.success { background: var(--success); color: var(--dark); }
        .toast.error { background: var(--danger); color: white; }

        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: var(--dark-lighter);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            max-width: 400px;
        }

        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(0, 255, 136, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 1.5rem auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .modal-title { font-size: 1.25rem; margin-bottom: 0.5rem; }
        .modal-text { color: var(--text-muted); }

        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .nav-links { display: none; }
            .wallet-banner-content { flex-direction: column; text-align: center; }
            .status-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="toast" id="toast"></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Processing</div>
            <div class="spinner"></div>
            <div class="modal-text" id="modalText">Please wait...</div>
        </div>
    </div>

    <!-- Preview Banner -->
    <div class="preview-banner">
        <div class="preview-banner-content">
            <span class="preview-badge">Preview</span>
            <span class="preview-text">This is a demo of the Validify dashboard. Protocol launching Q1 2026. <a href="index.html#early-access">Request early access ‚Üí</a></span>
        </div>
    </div>

    <nav class="dashboard-nav">
        <div class="nav-left">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="crystalGradD1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#00ff88"/>
                                <stop offset="50%" style="stop-color:#00d4ff"/>
                                <stop offset="100%" style="stop-color:#667eea"/>
                            </linearGradient>
                            <linearGradient id="crystalGradD2" x1="100%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea"/>
                                <stop offset="100%" style="stop-color:#00ff88"/>
                            </linearGradient>
                        </defs>
                        <path d="M30 4 L50 17 L46 43 L30 54 L14 43 L10 17 Z" fill="none" stroke="url(#crystalGradD1)" stroke-width="2.5"/>
                        <path d="M30 4 L30 28 L10 17 Z" fill="url(#crystalGradD2)" opacity="0.3"/>
                        <path d="M30 4 L50 17 L30 28 Z" fill="url(#crystalGradD1)" opacity="0.4"/>
                        <path d="M30 28 L14 43 L10 17 Z" fill="url(#crystalGradD2)" opacity="0.2"/>
                        <path d="M30 28 L46 43 L50 17 Z" fill="url(#crystalGradD1)" opacity="0.25"/>
                        <line x1="30" y1="28" x2="30" y2="54" stroke="url(#crystalGradD1)" stroke-width="1.5" opacity="0.5"/>
                        <path d="M22 22 L30 36 L38 22" fill="none" stroke="#ffffff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        
                    </svg>
                </div>
                <span class="logo-text">VALIDIFY</span>
            </a>
            <div class="nav-links">
                <a href="#" class="active">Dashboard</a>
                <a href="#">Security</a>
                <a href="#">Events</a>
                <a href="#">Settings</a>
            </div>
        </div>
        <div class="nav-right">
            <a href="index.html" class="back-link">‚Üê Back to Site</a>
            <button class="wallet-btn" id="connectBtn" onclick="connectWallet()">ü¶ä Connect Wallet</button>
        </div>
    </nav>

    <div class="dashboard">
        <div class="wallet-banner" id="walletBanner">
            <div class="wallet-banner-content">
                <div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">Connected Wallet</div>
                    <div class="wallet-address" id="walletAddress">0x0000...0000</div>
                </div>
                <div class="wallet-stats">
                    <div class="wallet-stat">
                        <div class="wallet-stat-label">ETH</div>
                        <div class="wallet-stat-value" id="ethBalance">0.00</div>
                    </div>
                    <div class="wallet-stat">
                        <div class="wallet-stat-label">VLFY</div>
                        <div class="wallet-stat-value" id="vlfyBalance">0</div>
                    </div>
                    <div class="wallet-stat">
                        <div class="wallet-stat-label">Activity</div>
                        <div class="wallet-stat-value" id="activityCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card connect-prompt" id="connectPrompt">
            <h2>Dashboard Preview</h2>
            <p>This is a preview of the Validify community dashboard. Connect a wallet to explore the demo interface.</p>
            <button class="wallet-btn" onclick="connectWallet()" style="font-size: 1.1rem; padding: 1rem 2rem;">ü¶ä Connect MetaMask</button>
            <p style="margin-top: 1.5rem; font-size: 0.85rem;">
                <span style="color: var(--accent);">‚ÑπÔ∏è</span> Demo mode ‚Äî no real transactions
            </p>
        </div>

        <div class="dashboard-grid" id="dashboardContent" style="display: none;">
            <div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üîê Protection Tiers</div>
                        <span class="card-badge">Coming Q1 2026</span>
                    </div>
                    <div class="tier-grid">
                        <div class="tier-card" id="tier1Card">
                            <div class="tier-header">
                                <div class="tier-name">‚ö° Foundation</div>
                                <div class="tier-price">Core Protection</div>
                            </div>
                            <div class="tier-features">Multi-sig verification ‚Ä¢ Admin monitoring ‚Ä¢ Threat alerts ‚Ä¢ On-chain attestations</div>
                            <button class="tier-btn preview" disabled>Coming Soon</button>
                        </div>
                        <div class="tier-card" id="tier2Card">
                            <div class="tier-header">
                                <div class="tier-name">üöÄ Intelligence</div>
                                <div class="tier-price">Enhanced Protection</div>
                            </div>
                            <div class="tier-features">Core + Cross-community alerts ‚Ä¢ Behavioral analysis ‚Ä¢ Priority threat feed</div>
                            <button class="tier-btn preview" disabled>Coming Soon</button>
                        </div>
                        <div class="tier-card" id="tier3Card">
                            <div class="tier-header">
                                <div class="tier-name">üíé Enterprise</div>
                                <div class="tier-price">Full Protocol Access</div>
                            </div>
                            <div class="tier-features">Intelligence + Multi-platform ‚Ä¢ Custom integrations ‚Ä¢ Dedicated support</div>
                            <button class="tier-btn preview" disabled>Coming Soon</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">üìä Security Events</div>
                        <span class="card-badge">Demo Data</span>
                    </div>
                    <div class="event-feed" id="eventFeed">
                        <div class="event-item">
                            <div class="event-header">
                                <span class="event-category">Link</span>
                                <span class="event-confidence">86% confidence</span>
                            </div>
                            <div class="event-title">Suspicious domain flagged in #announcements</div>
                            <a href="event.html?id=link-001" class="event-link">View evidence ‚Üí</a>
                        </div>
                        <div class="event-item">
                            <div class="event-header">
                                <span class="event-category">Roles</span>
                                <span class="event-confidence">78% confidence</span>
                            </div>
                            <div class="event-title">High-privilege role permission change detected</div>
                            <a href="event.html?id=roles-001" class="event-link">View details ‚Üí</a>
                        </div>
                        <div class="event-item">
                            <div class="event-header">
                                <span class="event-category">Bots</span>
                                <span class="event-confidence">74% confidence</span>
                            </div>
                            <div class="event-title">New bot added with elevated permissions</div>
                            <a href="event.html?id=bots-001" class="event-link">Review event ‚Üí</a>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">üìã Protocol Contracts</div>
                        <span class="card-badge">Testnet Preview</span>
                    </div>
                    <div class="contract-item">
                        <div class="contract-label">VLFY Token (Testnet)</div>
                        <div class="contract-address">0x813986e8908560FDD2Eda4DE2aF10623ae845b2f</div>
                        <a href="https://sepolia.etherscan.io/address/0x813986e8908560FDD2Eda4DE2aF10623ae845b2f" target="_blank" class="contract-link">View on Sepolia ‚Üí</a>
                    </div>
                    <div class="contract-item">
                        <div class="contract-label">Service Manager (Testnet)</div>
                        <div class="contract-address">0x976b419eA3aB69F643F9Bba82007D58dA275f966</div>
                        <a href="https://sepolia.etherscan.io/address/0x976b419eA3aB69F643F9Bba82007D58dA275f966" target="_blank" class="contract-link">View on Sepolia ‚Üí</a>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.75rem;">Mainnet contracts deploying Q1 2026</p>
                </div>
            </div>

            <div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üõ°Ô∏è Security Status</div>
                        <span class="card-badge">Demo</span>
                    </div>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">Protocol</div>
                            <div class="status-value inactive" id="engineStatus">Preview</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Tier</div>
                            <div class="status-value" id="tierStatus">--</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Status</div>
                            <div class="status-value" id="daysLeft">Demo</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Threats Blocked</div>
                            <div class="status-value" id="linksFlagged">--</div>
                        </div>
                    </div>
                    <button class="tier-btn preview" disabled style="background: var(--primary-dim); color: var(--text-muted); border: 1px solid rgba(0,255,136,0.2);">Live data coming Q1 2026</button>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">üíß Demo Tokens</div>
                        <span class="card-badge">Sepolia Only</span>
                    </div>
                    <div class="faucet-info">
                        <div class="faucet-status" id="faucetStatus">Connect wallet to check</div>
                        <div class="faucet-amount">10,000 VLFY</div>
                    </div>
                    <button class="tier-btn" id="faucetBtn" onclick="claimFaucet()">Claim Demo VLFY</button>
                    <p style="text-align: center; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.75rem;">‚ÑπÔ∏è Testnet tokens for demo purposes only</p>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">üîó Community Integration</div>
                        <span class="card-badge">Q1 2026</span>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">Connect your Discord or Telegram community to enable protocol protection.</p>
                    <a href="index.html#early-access" class="tier-btn" style="display: block; text-align: center; text-decoration: none;">Request Early Access</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONTRACTS = {
            token: '0x813986e8908560FDD2Eda4DE2aF10623ae845b2f',
            service: '0x976b419eA3aB69F643F9Bba82007D58dA275f966'
        };

        const TOKEN_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function claimFaucet()",
            "function canClaimFaucet(address) view returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function approve(address,uint256) returns (bool)"
        ];

        const SERVICE_ABI = [
            "function activateService(uint8)",
            "function getSubscription(address) view returns (uint8,uint256,uint256,bool,uint256)",
            "function hasActiveSubscription(address) view returns (bool)"
        ];

        let state = { provider: null, signer: null, address: null, tokenContract: null, serviceContract: null };

        async function connectWallet() {
            try {
                if (!window.ethereum) { showToast('Please install MetaMask!', true); return; }

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                state.provider = new ethers.providers.Web3Provider(window.ethereum);
                state.signer = state.provider.getSigner();
                state.address = accounts[0];

                const network = await state.provider.getNetwork();
                if (network.chainId !== 11155111) {
                    showToast('Please switch to Sepolia Testnet', true);
                    try {
                        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0xaa36a7' }] });
                        window.location.reload();
                    } catch (e) { return; }
                    return;
                }

                state.tokenContract = new ethers.Contract(CONTRACTS.token, TOKEN_ABI, state.signer);
                state.serviceContract = new ethers.Contract(CONTRACTS.service, SERVICE_ABI, state.signer);

                document.getElementById('connectBtn').innerHTML = '‚úÖ ' + state.address.slice(0, 6) + '...' + state.address.slice(-4);
                document.getElementById('connectBtn').classList.add('connected');
                document.getElementById('walletAddress').textContent = state.address.slice(0, 6) + '...' + state.address.slice(-4);
                document.getElementById('walletBanner').classList.add('show');
                document.getElementById('connectPrompt').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'grid';

                showToast('Wallet connected!', false);
                loadData();

                window.ethereum.on('accountsChanged', () => window.location.reload());
                window.ethereum.on('chainChanged', () => window.location.reload());
            } catch (e) { showToast('Connection failed: ' + e.message, true); }
        }

        async function loadData() {
            if (!state.address) return;
            try {
                const ethBal = await state.provider.getBalance(state.address);
                document.getElementById('ethBalance').textContent = parseFloat(ethers.utils.formatEther(ethBal)).toFixed(3);

                const vlfyBal = await state.tokenContract.balanceOf(state.address);
                document.getElementById('vlfyBalance').textContent = ethers.utils.formatEther(vlfyBal).split('.')[0];

                const canClaim = await state.tokenContract.canClaimFaucet(state.address);
                document.getElementById('faucetStatus').textContent = canClaim ? '‚úÖ Ready to claim!' : '‚è≥ Cooldown active';
                document.getElementById('faucetBtn').disabled = !canClaim;

                const sub = await state.serviceContract.getSubscription(state.address);
                const tierNames = ['None', 'Basic', 'Advanced', 'Pro'];
                const tierIndex = Number(sub[0]);
                const isActive = Boolean(sub[3]);
                const daysRemaining = sub[4].toString();

                document.getElementById('engineStatus').textContent = isActive ? 'Active' : 'Inactive';
                document.getElementById('engineStatus').className = 'status-value ' + (isActive ? 'active' : 'inactive');
                document.getElementById('tierStatus').textContent = tierNames[tierIndex];
                document.getElementById('daysLeft').textContent = daysRemaining;

                document.querySelectorAll('.tier-card').forEach((card, i) => {
                    card.classList.remove('active');
                    const btn = card.querySelector('.tier-btn');
                    btn.classList.remove('active-btn');
                    btn.textContent = 'Activate ' + ['Basic', 'Advanced', 'Pro'][i];
                    btn.disabled = false;
                });

                if (tierIndex > 0 && isActive) {
                    document.getElementById('tier' + tierIndex + 'Card').classList.add('active');
                    const activeBtn = document.getElementById('tier' + tierIndex + 'Btn');
                    activeBtn.classList.add('active-btn');
                    activeBtn.textContent = '‚úì Active';
                }

                if (isActive) {
                    document.getElementById('activityCount').textContent = String(3 * tierIndex);
                    document.getElementById('linksFlagged').textContent = String(3 * tierIndex);
                }
            } catch (e) { console.error('Load error:', e); }
        }

        async function claimFaucet() {
            if (!state.tokenContract) { showToast('Connect wallet first!', true); return; }
            try {
                const canClaim = await state.tokenContract.canClaimFaucet(state.address);
                if (!canClaim) { showToast('Faucet cooldown active. Wait 24h.', true); return; }

                showModal('Claiming VLFY', 'Confirm transaction in MetaMask...');
                const tx = await state.tokenContract.claimFaucet();
                updateModal('Processing', 'Waiting for confirmation...');
                await tx.wait();

                hideModal();
                showToast('Claimed 10,000 VLFY!', false);
                loadData();
            } catch (e) { hideModal(); showToast('Claim failed: ' + e.message, true); }
        }

        async function activateService(tier) {
            if (!state.serviceContract) { showToast('Connect wallet first!', true); return; }
            const prices = [0, 500, 1500, 5000];
            const price = ethers.utils.parseEther(prices[tier].toString());

            try {
                showModal('Activating Service', 'Checking allowance...');
                const allowance = await state.tokenContract.allowance(state.address, CONTRACTS.service);

                if (allowance.lt(price)) {
                    updateModal('Approval Required', 'Approve VLFY spending...');
                    const approveTx = await state.tokenContract.approve(CONTRACTS.service, price);
                    updateModal('Approval Required', 'Waiting for confirmation...');
                    await approveTx.wait();
                }

                updateModal('Activating', 'Confirm activation...');
                const tx = await state.serviceContract.activateService(tier);
                updateModal('Activating', 'Waiting for confirmation...');
                await tx.wait();

                hideModal();
                showToast('Service activated! üéâ', false);
                loadData();
            } catch (e) { hideModal(); showToast('Activation failed: ' + (e.reason || e.message), true); }
        }

        async function addToken() {
            try {
                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: { type: 'ERC20', options: { address: CONTRACTS.token, symbol: 'VLFY', decimals: 18 } }
                });
                showToast('VLFY added to MetaMask!', false);
            } catch (e) { showToast('Failed to add token', true); }
        }

        function showToast(message, isError) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + (isError ? 'error' : 'success');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function showModal(title, text) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').textContent = text;
            document.getElementById('modal').classList.add('show');
        }

        function updateModal(title, text) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').textContent = text;
        }

        function hideModal() { document.getElementById('modal').classList.remove('show'); }
    </script>
</body>
</html>
