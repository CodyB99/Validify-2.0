<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validify: Discord Security Prototype (Testnet)</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid #00ff88;
        }
        h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.85em;
            border: 1px solid #00ff88;
        }
        .wallet-btn {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
        }
        .wallet-btn:hover { transform: scale(1.05); }
        .wallet-info {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff88;
            margin-top: 20px;
            display: none;
        }
        .wallet-info.show { display: block; }
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .panel {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 25px;
        }
        .panel h2 { color: #00ff88; margin-bottom: 20px; border-bottom: 2px solid #00ff88; padding-bottom: 10px; }
        .service-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border: 3px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        .btn {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        .btn:hover:not(:disabled) { transform: scale(1.02); }
        .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.5; }
        .stat-box {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin: 10px 0;
        }
        .stat-label { font-size: 0.9em; color: #00d4ff; }
        .stat-value { font-size: 2em; font-weight: bold; color: #00ff88; margin-top: 5px; }
        .contract-address {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            word-break: break-all;
            margin: 10px 0;
            border: 1px solid #00ff88;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.95);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
            z-index: 1000;
        }
        .toast.show { display: block; }
        .toast.error { background: rgba(255, 68, 68, 0.95); color: white; }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #00ff88;
            text-align: center;
        }
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #00ff88;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="toast" id="toast"></div>
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 style="color: #00ff88;">Processing Transaction</h2>
            <div class="spinner"></div>
            <p id="modalText">Please wait...</p>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üõ°Ô∏è VALIDIFY</h1>
            <p style="font-size: 1.2em; color: #00d4ff; margin: 10px 0;">
                Discord Threat Prevention + Verification (Prototype)
            </p>
            <div>
                <span class="badge">üß™ Testnet Prototype (Sepolia)</span>
                <span class="badge">üîç Subscription + Access Layer</span>
                <span class="badge">üõ† Security Engine In Progress</span>
            </div>
            <p style="color: #bbb; font-size: 0.95em; margin-top: 12px;">
                This page is for concept testing. VLFY is a testnet access token used to validate subscription flows.
            </p>


            </div>
            <button class="wallet-btn" id="connectBtn" onclick="connectWallet()">ü¶ä Connect MetaMask</button>
            
            <div class="wallet-info" id="walletInfo">
                <div style="color: #00ff88; font-family: monospace; font-size: 1.1em; margin-bottom: 15px;" id="address"></div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div class="stat-box">
                        <div class="stat-label">ETH</div>
                        <div class="stat-value" style="font-size: 1.5em;" id="ethBal">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">VLFY</div>
                        <div class="stat-value" style="font-size: 1.5em;" id="vlfyBal">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Services</div>
                        <div class="stat-value" style="font-size: 1.5em;" id="services">0</div>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid">
            <div>
                <div class="panel">
                    <h2>üîê Security Services</h2>
                    
                    <div class="service-card">
                        <h3 style="color: #00d4ff; margin-bottom: 10px;">‚ö° BASIC - 500 VLFY (test cycle)</h3>
                        <p style="color: #ccc; margin-bottom: 15px;">Essential bot protection and monitoring</p>
                        <button class="btn" onclick="activateService(1)" id="btn1">Activate Basic</button>
                    </div>

                    <div class="service-card">
                        <h3 style="color: #00d4ff; margin-bottom: 10px;">üöÄ ADVANCED - 1,500 VLFY (test cycle)</h3>
                        <p style="color: #ccc; margin-bottom: 15px;">Enhanced security with wallet verification</p>
                        <button class="btn" onclick="activateService(2)" id="btn2">Activate Advanced</button>
                    </div>

                    <div class="service-card">
                        <h3 style="color: #00d4ff; margin-bottom: 10px;">üíé ENTERPRISE - 5,000 VLFY (test cycle)</h3>
                        <p style="color: #ccc; margin-bottom: 15px;">Complete protection suite with analytics</p>
                        <button class="btn" onclick="activateService(3)" id="btn3">Activate Enterprise</button>
                    </div>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h2>üìã Testnet Contracts</h2>
                    <div class="contract-address">
                        <strong style="color: #00ff88;">VLFY Token:</strong><br>
                        0x813986e8908560FDD2Eda4DE2aF10623ae845b2f
                        <br><a href="https://sepolia.etherscan.io/address/0x813986e8908560FDD2Eda4DE2aF10623ae845b2f" target="_blank" style="color: #00d4ff;">View on Etherscan ‚Üí</a>
                    </div>
                    <div class="contract-address">
                        <strong style="color: #00ff88;">Service Manager:</strong><br>
                        0x976b419eA3aB69F643F9Bba82007D58dA275f966
                        <br><a href="https://sepolia.etherscan.io/address/0x976b419eA3aB69F643F9Bba82007D58dA275f966" target="_blank" style="color: #00d4ff;">View on Etherscan ‚Üí</a>
                    </div>
                    <button class="btn" onclick="addToken()">‚ûï Add VLFY to MetaMask</button>
                </div>
            </div>

            <div>
                <div class="panel">
                    <h2>üí∞ Testnet Access Tokens (VLFY)</h2>
                    <div class="stat-box">
                        <div class="stat-label">Faucet Status</div>
                        <div class="stat-value" style="font-size: 1.3em;" id="faucetStatus">Check wallet</div>
                    </div>
                    <button class="btn" onclick="claimFaucet()" id="faucetBtn">üíß Claim 10,000 Testnet VLFY</button>
                    <p style="color: #888; font-size: 0.9em; margin-top: 10px; text-align: center;">
                        ‚ÑπÔ∏è Claim once every 24 hours
                    </p>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h2>üìä Your Subscription</h2>
                    <div class="stat-box">
                        <div class="stat-label">Active Tier</div>
                        <div class="stat-value" style="font-size: 1.5em;" id="tier">None</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Days Remaining</div>
                        <div class="stat-value" id="days">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" style="font-size: 1.3em;" id="status">Inactive</div>
                    </div>
                    <button class="btn" onclick="loadData()" style="margin-top: 15px;">üîÑ Refresh Status</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONTRACTS = {
            token: '0x813986e8908560FDD2Eda4DE2aF10623ae845b2f',
            service: '0x976b419eA3aB69F643F9Bba82007D58dA275f966'
        };

        const TOKEN_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function claimFaucet()",
            "function canClaimFaucet(address) view returns (bool)",
            "function approve(address,uint256) returns (bool)"
        ];

        const SERVICE_ABI = [
            "function activateService(uint8)",
            "function getSubscription(address) view returns (uint8,uint256,uint256,bool,uint256)",
            "function hasActiveSubscription(address) view returns (bool)"
        ];

        let state = { provider: null, signer: null, address: null, tokenContract: null, serviceContract: null };

        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    showToast('Install MetaMask!', true);
                    return;
                }

                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                state.provider = new ethers.providers.Web3Provider(window.ethereum);
                state.signer = state.provider.getSigner();
                state.address = accounts[0];

                const network = await state.provider.getNetwork();
                if (network.chainId !== 11155111) {
                    showToast('Switch to Sepolia Testnet!', true);
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0xaa36a7' }]
                        });
                        window.location.reload();
                    } catch (e) {
                        showToast('Please switch to Sepolia manually', true);
                    }
                    return;
                }

                state.tokenContract = new ethers.Contract(CONTRACTS.token, TOKEN_ABI, state.signer);
                state.serviceContract = new ethers.Contract(CONTRACTS.service, SERVICE_ABI, state.signer);

                document.getElementById('connectBtn').textContent = '‚úÖ Connected';
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('address').textContent = state.address.slice(0,6) + '...' + state.address.slice(-4);
                document.getElementById('walletInfo').classList.add('show');

                showToast('Connected successfully!');
                loadData();

                window.ethereum.on('accountsChanged', () => window.location.reload());
                window.ethereum.on('chainChanged', () => window.location.reload());
            } catch (e) {
                showToast('Connection failed: ' + e.message, true);
            }
        }

        async function loadData() {
            if (!state.address) {
                showToast('Connect wallet first!', true);
                return;
            }

            try {
                const ethBal = await state.provider.getBalance(state.address);
                document.getElementById('ethBal').textContent = parseFloat(ethers.utils.formatEther(ethBal)).toFixed(3);

                const vlfyBal = await state.tokenContract.balanceOf(state.address);
                document.getElementById('vlfyBal').textContent = ethers.utils.formatEther(vlfyBal).split('.')[0];

                const canClaim = await state.tokenContract.canClaimFaucet(state.address);
                document.getElementById('faucetStatus').textContent = canClaim ? 'Ready!' : 'Wait 24h';
                document.getElementById('faucetBtn').disabled = !canClaim;

                const sub = await state.serviceContract.getSubscription(state.address);
                const tierNames = ['None', 'Basic', 'Advanced', 'Enterprise'];
                document.getElementById('tier').textContent = tierNames[sub[0]];
                document.getElementById('days').textContent = sub[4].toString();
                document.getElementById('status').textContent = sub[3] ? 'Active' : 'Inactive';
                document.getElementById('services').textContent = sub[3] ? '1' : '0';
            } catch (e) {
                console.error('Load error:', e);
            }
        }

        async function claimFaucet() {
            if (!state.tokenContract) {
                showToast('Connect wallet first!', true);
                return;
            }

            try {
                showModal('Claiming 10,000 VLFY...');
                const tx = await state.tokenContract.claimFaucet();
                updateModal('Waiting for confirmation...');
                await tx.wait();
                hideModal();
                showToast('Successfully claimed 10,000 VLFY!');
                loadData();
            } catch (e) {
                hideModal();
                showToast('Claim failed: ' + e.message, true);
            }
        }

        async function activateService(tier) {
            if (!state.serviceContract) {
                showToast('Connect wallet first!', true);
                return;
            }

            const prices = [0, 500, 1500, 5000];
            const price = ethers.utils.parseEther(prices[tier].toString());

            try {
                showModal('Checking allowance...');
                
                "function allowance(address owner, address spender) view returns (uint256)"
                if (allowance.lt(price)) {
                    updateModal('Approving VLFY tokens...');
                    const approveTx = await state.tokenContract.approve(CONTRACTS.service, price);
                    await approveTx.wait();
                }

                updateModal('Activating service...');
                const tx = await state.serviceContract.activateService(tier);
                updateModal('Waiting for confirmation...');
                await tx.wait();
                
                hideModal();
                showToast('Service activated successfully! üéâ');
                loadData();
            } catch (e) {
                hideModal();
                showToast('Activation failed: ' + (e.reason || e.message), true);
            }
        }

        async function addToken() {
            try {
                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: CONTRACTS.token,
                            symbol: 'VLFY',
                            decimals: 18
                        }
                    }
                });
                showToast('VLFY added to MetaMask!');
            } catch (e) {
                showToast('Failed to add token', true);
            }
        }

        function showToast(msg, error = false) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = 'toast show' + (error ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function showModal(text) {
            document.getElementById('modalText').textContent = text;
            document.getElementById('modal').classList.add('show');
        }

        function updateModal(text) {
            document.getElementById('modalText').textContent = text;
        }

        function hideModal() {
            document.getElementById('modal').classList.remove('show');
        }
    </script>
</body>
</html>
